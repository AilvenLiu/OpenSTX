# 项目现状与分析文档 - 20240822

## 0. 项目简介

本项目旨在通过实时数据请求与历史数据增量获取的方式，结合多线程架构和数据库存储，实现对SPY正股的交易分析与策略执行。文档将详述当前实现的功能、数据请求和处理结构、以及基于现有数据能力可以应用的高级策略。文档还将讨论在结合高级策略进行有效期权交易时，现有数据的不足和未来的改进方向。

## 1. 现有的数据和数据请求、计算、处理、存储结构

### 1.1 数据表结构

1. **`l1_data`**: 存储L1（逐笔交易）数据，包含datetime、bid、ask、last、open、high、low、close、volume。
2. **`l2_data`**: 存储L2（市场深度）数据，包含datetime、price_level、bid_price、bid_size、ask_price、ask_size。
3. **`feature_data`**: 存储通过L1/L2数据计算得出的特征数据，包含datetime、gap、today_open、total_l2_volume、rsi、macd、vwap。
4. **`daily_data`**: 存储SPY正股的日线历史数据，包含date、symbol、open、high、low、close、volume、adj_close。

### 1.2 数据请求与处理架构

- **实时数据请求**:
  - 通过RealTimeData类，实时获取SPY正股的L1和L2数据。
  - 每秒请求L1和L2数据，并通过两个独立线程分别处理数据请求和数据聚合。
  - 聚合的数据（每分钟级别）会被计算出特征值（如RSI、MACD等），并存储在TimescaleDB中。

- **历史数据请求**:
  - 每日闭市后，增量获取历史日线数据，并计算相关特征值，存储于数据库中。

### 1.3 数据处理流程

- 实时获取的L1/L2数据经过聚合和特征值计算后，按照分钟级别存储。
- 闭市时段通过独立线程获取日线历史数据，并存储。

## 2. 现有的功能和线程作用

### 2.1 主要功能

1. 实时获取SPY正股的L1和L2数据。
2. 实时计算并存储每分钟的特征值（如RSI、MACD、VWAP等）。
3. 在闭市时段，增量获取历史日线数据，并进行存储。

### 2.2 线程作用

1. **数据请求线程**: 每秒请求实时L1和L2数据。
2. **数据处理线程**: 每分钟聚合实时数据，计算特征值并存储。
3. **历史数据请求线程**: 在闭市期间，按天增量获取历史数据。

## 3. 可应用的高级策略及正股交易

### 3.1 可应用的高级策略

根据现有的数据和数据请求能力，可以应用以下高级策略进行有效的SPY正股交易：

1. **趋势跟随策略**:
   - 使用RSI、MACD等技术指标识别趋势并做出交易决策。
   - 通过L2数据识别市场深度变化，辅助判断买卖时机。

2. **市场微观结构分析**:
   - 利用L2盘口数据分析市场流动性、支撑和阻力位，优化进出场时机。
   - 结合VWAP计算，判断大资金的操作行为。

3. **量价分析策略**:
   - 基于成交量与价格变化的关联性，识别买卖信号。
   - 利用多时间框架分析（分钟级与日线级结合）进行策略优化。

### 3.2 有效的SPY正股交易

现有数据足以支持精确的SPY正股交易，包括但不限于高频短线交易和中长线趋势交易。实时数据请求与处理能力可以有效支持市场微观结构分析策略，通过L2数据分析市场动向并优化交易策略。

## 4. 结合高级策略的有效期权交易差距及改进方向

### 4.1 差距

1. **缺乏期权市场数据**:
   - 目前的系统仅涉及正股的L1/L2数据，没有涵盖期权合约数据（如行权价、到期日、隐含波动率等）。
   - 缺乏希腊字母（Delta、Gamma、Vega、Theta等）的计算和存储。

2. **缺乏期权交易特定指标**:
   - 期权交易所需的核心指标（如隐含波动率）在当前系统中无法计算，导致策略构建的局限性。

3. **缺乏期权链数据**:
   - 期权链是进行期权交易策略（如蝶式、跨式等）设计的基础数据，但当前系统尚未实现对期权链的支持。

### 4.2 改进方向

1. **扩展数据获取范围**:
   - 订阅并获取期权市场数据，包括期权链、希腊字母、隐含波动率等。

2. **数据计算与存储**:
   - 实现期权特定指标的计算（如希腊字母）并进行存储。
   - 在实时数据请求中添加期权数据支持，并扩展现有存储结构。

3. **策略扩展与验证**:
   - 结合新的数据结构与实时数据处理能力，开发并验证复杂的期权交易策略。
   - 优化现有正股策略，并通过期权对冲或增强收益。
